{"version":3,"file":"raatwerk.js","sources":["../src/raatwerk.js"],"sourcesContent":["\r\nwindow = self;  // to keep tau-prolog.js happy; expects window != undefined\r\n\r\nfunction Werk(id, options, data) {\r\n    let loc = location.pathname;\r\n    this.dir = loc.substring(0, loc.lastIndexOf('/') + 1);\r\n\r\n    // importScripts  only works for local scripts!\r\n    importScripts(this.dir + 'tau-prolog.js', this.dir + 'pl-sjaakp.js');\r\n\r\n    this.session = pl.create(20000);\r\n\r\n    this.session.consult(this.dir + 'raatsel.pl', {\r\n        script: false,\r\n        success: () => {\r\n            this.query('init.');\r\n        },\r\n        error: () => console.log(' consult error', 'raatsel.pl')\r\n    });\r\n    this.session.consult(this.dir + 'oplossing.pl', {\r\n        script: false,\r\n    });\r\n}\r\n\r\nWerk.prototype = {\r\n\r\n    query(q, maxAnswers = 10)\r\n    {\r\n        this.session.query(q, {\r\n            success: () => {\r\n                this.answers(q, maxAnswers);\r\n            },\r\n            error: () => console.log('query error', q),\r\n        });\r\n    },\r\n\r\n    answers(query, max = 10)\r\n    {\r\n        if (max > 0)    {\r\n            this.session.answer(\r\n                {\r\n                    success: (a) => {\r\n                        if (query === 'retractall(mag(_,_)).')  {\r\n                            this.session.consult(this.opl, {\r\n                                script: false,\r\n                                success: () => {\r\n                                    postMessage({ command: 'setChecks', pars: [ ] });\r\n                                },\r\n                                error: () => console.log(' consult error', 'opl')\r\n                            });\r\n                        }\r\n                        else postMessage({ command: 'showAnswer', pars: [ query, this.session.format_answer(a) ] });\r\n                        this.answers( query, max-1 );\r\n                    },\r\n                    error: (e) => { console.log(query, 'error', e); },\r\n                    fail: () => {\r\n                        postMessage({ command: 'failOrLimit', pars: [ query, 'fail' ] });\r\n                        },\r\n                    limit: () => {\r\n                        postMessage({ command: 'failOrLimit', pars: [ query, 'limit' ] });\r\n                        },\r\n                }\r\n            );\r\n        }\r\n    },\r\n\r\n    plusMag(par1, par2)\r\n    {\r\n        this.query(`assertz(mag(${par1}, ${par2})).`)\r\n    },\r\n\r\n    minMag(par1, par2)\r\n    {\r\n        this.query(`retract(mag(${par1}, ${par2})).`)\r\n    },\r\n\r\n    laad(opl)\r\n    {\r\n        this.opl = opl;\r\n        this.query( 'retractall(mag(_,_)).');\r\n        console.log('laad', opl);\r\n    }\r\n};\r\n\r\nconst werk = new Werk(0, 0, 0);\r\n\r\nonmessage = e => {\r\n    werk[e.data.command].apply(werk, e.data.pars);\r\n};\r\n\r\nleegCel = (celAtom) =>\r\n{\r\n    postMessage({ command: 'emptyCell', pars: [ celAtom ] });\r\n}\r\n\r\nvulCel = (celAtom, txtAtom) =>\r\n{\r\n    postMessage({ command: 'fillCell', pars: [ celAtom, txtAtom ] });\r\n}\r\n\r\nconsole.log('self', self);\r\nconsole.log('pl', pl);\r\n"],"names":["let","this","const"],"mappings":"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"}